---
title: "Naive_Bayes_Record_Data"
author: "Cynthia Ng"
date: "2022-10-13"
output: html_document
---

## Setup
```{r}
# Load relevant libraries
knitr::opts_chunk$set(echo = TRUE)
library(gmodels)
library(tidyverse)
library(ggplot2)
library(rstudioapi)

# Set directory
cur_dir <- dirname(getSourceEditorContext()$path)
setwd(cur_dir)
setwd("../data")

# Read csv
df <- read_csv("cleaned_wf_demo.csv")

# Study structure of df
str(df)
summary(df)
```

## Prepare for split
```{r}
# Create data frame for only predictor and outcome
df <- df[df$region=='Northern America',]

mydata <- data.frame(df$salary, df$ethnicity) #select ethnicity and salary
colnames(mydata) <- c('mypredictor', 'myresponse')

mydata <- na.omit(mydata)
summary(mydata)
```

## Split into training and testing sets
```{r}
# # SPLIT METHOD 1
# # Create partition
# trainIndex = createDataPartition(y = mydata$myresponse, p = 0.8, list = FALSE)
# train = mydata[trainIndex,]
# test = mydata

# SPLIT METHOD 2
set.seed(42)
index = sample(2,nrow(mydata),prob = c(0.8,0.2),replace=TRUE) #sample training and testing sets
#training set, dataframe
train = mydata[index==1,]
#testing set, dataframe
test = mydata[index==2,]

# # SPLIT METHOD 3
# split = sample.split(mydata$myresponse, SplitRatio = 0.75)
# train = subset(mydata, split == TRUE)
# test = subset(mydata, split == FALSE)
# 
# # Feature scaling
# train[-3] = scale(train[-3])
# test[-3] = scale(test[-3])

# Check dimensions of train and test
dim(train)
dim(test)

# Check proportions of predictor in train and test, which should be similar
table(train$myresponse) %>% prop.table()
table(test$myresponse) %>% prop.table()

# Pull X and y from train and test
X_train <- train$mypredictor
y_train <- train$myresponse
X_test <- test$mypredictor
y_test <- test$myresponse
head(train)
head(X_train)

# Check lengths. Lengths of X_train and y_train must equal, while lengths of X_test and y_test must equal.
length(X_train)
length(y_train)
length(X_test)
length(y_test)
```

```{r}
# # Load library
# library(naivebayes)
# class(X_train)
# # create response and feature data
# gnb <- gaussian_naive_bayes(x = data.matrix(X_train), y = y_train)
# 
# ypred <- (predict(gnb, newdata = data.matrix(X_test), type = "class")) 
# 
# # test accuracy
# accuracy_method1 <- round((sum(ypred==y_test)/length(y_test))*100 , digits = 0)
# paste("Method 1 accuracy: " , accuracy_method1, "%")
```


## Naive Bayes Model
```{r}
# Load library for Naive Bayes modelling
library(e1071)
library(caTools)
library(caret)
library(naivebayes)

# Fit Naive Bayes Model to training data set
set.seed(42)
nb_model = naiveBayes(myresponse ~ ., data=X_train)

# Predict on test data
y_pred <- predict(nb_model, newdata = test)
```
## Accuracy
```{r}
accuracy_model <- round((sum(ypred==y_test)/length(y_test))*100 , digits = 0)
paste("Model accuracy: " , accuracy_method1, "%")
```

## Confusion Matrix
```{r}
# Confusion Matrix
cm <- table(test$myresponse, y_pred)
cm

# Model Evaluation
confusionMatrix(cm)
```

## Export prediction data
```{r}
naive_gender_salary=cbind(mydata_test,pred)
naive_gender_salary$Naive_Bayes_Classification=for_export$pred
naive_gender_salary$pred=NULL

View(naive_gender_salary)

# Save in wd
setwd("../anly-501-project-cynthia-ng/data")
write.csv(naive_gender_salary, "naive_gender_salary.csv")
```