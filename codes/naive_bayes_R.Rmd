---
title: "Naive_Bayes_Record_Data"
author: "Cynthia Ng"
date: "2022-10-13"
output: html_document
---

## Setup
```{r}
# Load relevant libraries
knitr::opts_chunk$set(echo = TRUE)
library(gmodels)
library(tidyverse)
library(ggplot2)
library(rstudioapi)

# Set directory
cur_dir <- dirname(getSourceEditorContext()$path)
setwd(cur_dir)
setwd("../data")

# Read csv
df <- read_csv("cleaned_wf_demo.csv")

# Study structure of df
str(df)
summary(df)
```

## Prepare for split
```{r}
# Create data frame for only predictor and outcome
df <- df[df$region=='Northern America',]
mydata <- data.frame(df$ethnicity, df$salary) #select gender and salary

# Omit na values
mydata<-na.omit(mydata)
```

## Split into training and testing sets
```{r}
# Create partition
trainIndex = createDataPartition(y = mydata$ethnicity, p = 0.8, list = FALSE)
train = mydata[trainIndex,]
test = mydata[-trainIndex,]

# Check dimensions of train and test
dim(train)
dim(test)

# Check proportions of predictor in train and test, which should be similar
table(train$ethnicity) %>% prop.table()
table(test$ethnicity) %>% prop.table()

```

```{r}
# create response and feature data
features <- setdiff(names(train), "ethnicity")
x <- train[, features]
y <- train$ethnicity

# train model
nb.m1 <- train(
  x = salary,
  y = ethnicity,
  method = "nb"
  )

# results
confusionMatrix(nb.m1)
```


## Naive Bayes Model
```{r}
# Load library for Naive Bayes modelling
library(e1071)
library(caTools)
library(caret)

# Create X and y
X = train$mypredictor
y = train$myresponse

# Fit Naive Bayes Model to training data set
set.seed(42)
nb_model = naiveBayes(myresponse ~ ., data=train)

# Predict on test data
y_pred <- predict(nb_model, newdata = test)
```

## Confusion Matrix
```{r}
# Confusion Matrix
cm <- table(test$myresponse, y_pred)
cm

# Model Evaluation
confusionMatrix(cm)
```

## Export prediction data
```{r}
naive_gender_salary=cbind(mydata_test,pred)
naive_gender_salary$Naive_Bayes_Classification=for_export$pred
naive_gender_salary$pred=NULL

View(naive_gender_salary)

# Save in wd
setwd("../anly-501-project-cynthia-ng/data")
write.csv(naive_gender_salary, "naive_gender_salary.csv")
```